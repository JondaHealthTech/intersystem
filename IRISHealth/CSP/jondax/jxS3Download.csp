<!DOCTYPE html>
<html lang="en"> <!--Groot v1.1-->
    <head>
    	<script language="cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
		i $g(%session.Data("UserID"))="" s %response.Redirect="jxLockDown.csp" q 1
		q 1
		</script>
    	<script language="cache" runat="server">d HEAD1^WSP999</script>
        <link rel="stylesheet" href="assets/styles/jxS3Download.css">
    </head>
    <body>
        <div id="wrapper">
            <div class="bg-wrapper">
                <div class="bg3">
                    <img src="./assets/images/bg3.png">
                </div>
            </div>
            <div class="content">
                <div class="main-field">
                    <img class="logo mobile-active" src="./assets/images/Jonda X Logo White Pink.png" alt="Jonda Health">
                    <h1>Download your processed files</h1>
                    <h2 id='filecount'>You have transformed <span id='fileCount'>0</span> file(s) successfully</h2>                  	
 					<div class="results">
						<div class="table-border"></div>
						   <div class="result-table">
							<table class="table table-striped">
								<thead>
								<tr>
									<th class='number'>No.</th>
		                            <th class='filename'>File Name</th>
		                            <th class='Tname'>Template Name</th>
		                            <th class='status'>Status</th>
		                            <th class="action"></th>
								</tr>
								</thead>
								<tbody class="tab">
								 	<script language="cache"runat="SERVER">
								 		d WriteTable^jxS3Download
								 	</script>
								</tbody>
							</table>
						   </div>
						</div>
					<p id="acknowledgment">
					Transformed files are available for download for a limited period of 14 days.
					</p>
					
					</div>
					
				</div> 
            </div>

<script type="text/javascript" >
    var resizefunc = [];
</script>
        <!-- jQuery  -->
<script language="cache" runat="server">
	d jQueryCore^WSP999
</script>
</body>

<script type="text/javascript">
    let mySessionEnd;
    window.onload = jInit()
	document.onmousemove = parent.resetTimer;
	document.onmousedown = parent.resetTimer; // touchscreen presses
	document.ontouchstart = parent.resetTimer;
	document.onkeypress = parent.resetTimer;
	document.addEventListener('scroll', parent.resetTimer, true);
	let uploadedFiles = [];
	let fName;
	let fPath;
	let downloadStr;
	
	function jInit() {
		#server(..cInit())# 
		resetTimer()
	}
	function resetTimer(){
		clearTimeout(mySessionEnd);
		mySessionEnd = setTimeout(jLockDown, 3600000);
    }
    function clearTimer(){
		clearTimeout(mySessionEnd);
	}
	function jLockDown(){
		#server(..cLockDown())#
	}
	// Download file
	function jDownload(e) {
	    let rid=e.target.parentElement.parentElement.querySelector(".rid").textContent;
    	let status=e.target.parentElement.parentElement.querySelector(".status").textContent;
    	#server(..cDownload(rid))#		
		//alert(fPath+",  "+fName);
		
	    var blob = new Blob([downloadStr], {type: 'text/plain'});
		var link = document.createElement('a');
		link.href = URL.createObjectURL(blob);
		link.href = fPath+"\\"+fName; 
		link.download = fName;
		link.click();
		//alert(link.href);
		URL.revokeObjectURL(link.href);
		#server(..cDelete())#
		window.location.reload();
    }

</script>
    
 <script language="cache" method="cInit">
    	d Init^jxS3Download
    </script>
<script language="cache" method="cDelete" arguments="d1:%String">
    	d DeleteFile^jxS3Download
    	
    </script>

<script language="cache" method="cDownload" arguments="d1:%String">
    	d Download^jxS3Download
    </script>
<script language="cache" method="cLockDown">
		k %session.Data
		&js<window.open("jxLockDown.csp","_parent")>
	</script>
	</html>
