<html>	<!-- JX Unit under System Setting Menu -->
<head>
	<script language="cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
		; Lock down on no session data
		i $g(%session.Data("UserID"))="" s %response.Redirect="cLockDown.csp" q 1
		q 1
	</script>

	<script language="cache" runat="server">
		; Lock down non admin
		s r1="",id=$g(%session.Data("UserID")) &sql(SELECT IsAdmin INTO :r1 FROM "User" WHERE ID=:id)
		i r1'=1 s %response.Redirect="cLockDown.csp"
		d HEAD1^CSP999
	</script>
</head>

<body onload="jPopTab1();T1.focus()">
<form name="F1" id="F1">
	<h3 style="font-color:black"><span>JX Units</span></h3>	
	&nbsp;<span id="AlertText" Name="AlertText" class="alerttext"></span>
	<table name="Tab1" id="Tab1" width="100%" border="1" style='font-family:courier;font-color:black'>
		<tr>
			<td>ID</td>
			<td>Unit Name* <input type="radio" id="byName" name="R1" value="5" checked=1 onclick="jSortMe(5)"></td>
			<td>JX Name* <input type="radio" id="bySIName" name="R1" value="6" onclick="jSortMe(6)"></td>
			<td>Long Description</td>
			<td></td>
		</tr>
		<tr>
			<td></td>
			<td><input name="T1" id="T1" type="text" size="25" maxlength="50" style="font-family:courier; font-size:8pt" onblur="jValT1()"></td>
			<td><input name="T2" id="T2" type="text" size="25" maxlength="50" style="font-family:courier; font-size:8pt"></td>
			<td><input name="T3" id="T3" type="text" size="35" maxlength="50" style="font-family:courier; font-size:8pt"></td>
			<td><input name="B1" id="B1" type="button" value="Save" style="font-family:montserrat; font-size:10pt" onclick="jSaveMe()"></td>
		</tr>
		<tr>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
	</table>
</form>
</body>
<script type="text/javascript">
T1=self.F1.T1,T2=self.F1.T2,T3=self.F1.T3,B1=self.F1.B1

function jPopTab1(){
	// Populate table on load
	jClearTab1();
	#server(..cPopTab1())#
}

function jClearTab1(){
	// clear the table
	rows=document.getElementById('Tab1').rows
	RowNo=rows.length
	if (RowNo>2){
		while (RowNo>2){
			document.getElementById('Tab1').deleteRow(RowNo-1)
			RowNo=RowNo-1
		}
	}
}

function jSortMe(sortby){
	// Sort the table (5=By Name) (6=BY SIName)
	jClearTab1();
	#server(..cSortMe(sortby))#
}

function jValT1(){
	// Copy value of new input box1 to box2
	T2.value=T1.value
}

function jPopFields(id){
	// Poppulate new input boxes with selected row data
	#server(..cPopFields(id))#
}

function jDeleteMe(id){
	// Delete the row of unit
	ans=confirm("Are you sure you want to Delete this record?")
	if (ans==true){
		#server(..cDeleteMe(id))#
		jPopTab1()
	}
	
}

function jSaveMe(){
	document.getElementById("AlertText").innerHTML=""
	#server(..cSaveMe("",T1.value,T2.value,T3.value))#
	jPopTab1()
}
</script>

<script language="cache" method="cPopTab1">
	d PopTab1^cSIUnit
</script>

<script language="cache" method="cPopFields" arguments="d1:%String">
	d PopFields^cSIUnit
</script>

<script language="cache" method="cSortMe" arguments="d1:%String">
	d SortMe^cSIUnit
</script>

<script language="cache" method="cDeleteMe" arguments="d1:%String">
	d DeleteMe^cSIUnit
</script>

<script language="cache" method="cSaveMe" arguments="id,d1,d2,d3:%String">
	; Error handling for saving new unit
	s errmsg="" ;, id=""
	i d1="" s errmsg=$s(errmsg'="":errmsg_", ",1:"")_"Unit Name"
	i d2="" s errmsg=$s(errmsg'="":errmsg_", ",1:"")_"JX Name"
	i errmsg'="" s errmsg="Required fields missing: "_errmsg &js<alert("#(errmsg)#")> q
	d SaveMe^cSIUnit
	;d SaveUpdateUnit^cSIUnit
</script>
</html>