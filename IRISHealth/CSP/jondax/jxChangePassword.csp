<html>
<head>
	<script language="cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
		i $g(%session.Data("UserID"))="" s %response.Redirect="jxLockDown.csp" q 1
		q 1
	</script>
	<script language="cache" runat="server">
		s id=$g(%session.Data("UserID"))
		d HEAD1^WSP999
	</script>
	<link rel="stylesheet" href="assets/styles/jxChangePassword.css">
</head>
<body>
<form id="F1" autocomplete="off">
	<div id="wrapper">
	    <div class="bg-wrapper">
            <div class="bg3">
                <img src="./assets/images/bg3.png">
            </div>
	    </div>
	    <div class="content">
                <div class="main-field">
	        		<img class="logo mobile-active" src="./assets/images/Jonda X Logo White Pink.png" alt="Jonda Health">
                    <div id="reset-form" class="reset-form">
						<img class="reset-icon" src="./assets/images/password.png" alt="Password">
                		<h3>Let's set up your new password !</h3>
	            		<div id="org-pass" class="input-group">
							<input type="password" name="password" id="T1" placeholder="Enter original password" onchange="removeError(event)"/>
							<img src="./assets/images/eyeClose.png" onclick="jTogglePassword(event)" />
							<p class="error-text">The original password is incorrect.</p>
						</div>
						<div class="input-group">
							<input type="password" name="password" id="T2" placeholder="Enter new password" onchange="removeError(event)"/>
							<img src="./assets/images/eyeClose.png" onclick="jTogglePassword(event)" />
							<p class="error-text">Invalid password</p>
							<p class="error-text pw-match">Password cannot be the same as original password.</p>
						</div>
						<div class="input-group">
							<input type="password" name="c-password" id="T3" placeholder="Confirm your password" onchange="removeError(event)"/>
							<img src="./assets/images/eyeClose.png" onclick="jTogglePassword(event)" />
							<p class="error-text">Password not match</p>
						</div>
						<div class="pass-req">
							<p>Your password should contain</p>
							<div class="req-groups">
								<div class="req-group">
									<h5>8+</h5>
									<p>Characters</p>
								</div>
								<div class="req-group">
									<h5>AA</h5>
									<p>Uppercase</p>
								</div>
								<div class="req-group">
									<h5>aa</h5>
									<p>Lowercase</p>
								</div>
								<div class="req-group">
									<h5>123</h5>
									<p>Number</p>
								</div>
								<div class="req-group">
									<h5>&$#</h5>
									<p>Symbol</p>
								</div>
							</div>
						</div>
						<button type="button" onclick="jValidateMe()" id="B1" name="B1" class="btn btn-block waves-effect waves-light">
						Change Password
						</button>
					</div>
	        </div>
	    </div>
	</div>
    <div id="popup" class="popup inactive">
        <div class="popup-dialog">
            <img src="./assets/images/success.png" alt="Signup Success">
            <h4>Your password is now <br>successfully updated</h4>
            <div class="btn-group">
                <button type="button" class="green-btn" onclick="jLogout()">Okay</button>
            </div>
        </div>
    </div>
    <div id="popup1" class="popup inactive">
        <div class="popup-dialog">
            <img src="./assets/images/success.png" alt="Signup Success">
            <h4>Your password is now <br>successfully updated! Please log in again.</h4>
            <div class="btn-group">
                <button type="button" class="green-btn" onclick="window.open('jxMain.csp','_parent')">Okay</button>
            </div>
        </div>
    </div>
	<script type="text/javascript">var resizefunc = [];</script>
	<!-- jQuery  -->
	<script language="cache" runat="server">
		d jQueryCore^WSP999
	</script>
</form>
</body>
<script type="text/javascript">
	T1=self.F1.T1,T2=self.F1.T2,T3=self.F1.T3
	window.onload = parent.resetTimer;
  	document.onmousemove = parent.resetTimer;
  	document.onmousedown = parent.resetTimer; // touchscreen presses
  	document.ontouchstart = parent.resetTimer;
  	//document.onclick = parent.resetTimer; // touchpad clicks
  	document.onkeypress = parent.resetTimer;
  	document.addEventListener('scroll', parent.resetTimer, true); 
  	
	function jTogglePassword(e) {
		let input = e.target.closest(".input-group").querySelector("input");
		if (input.type == "password") {
			input.type = "text";
			e.target.src = "./assets/images/eyeOpen.png";
		} else {
			input.type = "password";
			e.target.src = "./assets/images/eyeClose.png";
		}
	}
	function jValidateMe(e) {
		let check = true;
		if(T1.value==""){
			T1.nextElementSibling.nextElementSibling.classList.add("active");
			check = false;
		}
		if (T1.value == T2.value && T1.value!=""){
			T2.nextElementSibling.nextElementSibling.nextElementSibling.classList.add("active");
			check = false;
		}
		if (T2.value != T3.value){
			T3.nextElementSibling.nextElementSibling.classList.add("active");
			check = false;
		}
		if (!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[$&+,:;=?@#|'<>.-^*()%!])[A-Za-z\d$&+,:;=?@#|'<>.-^*()%!]{8,}$/.test(T2.value)){
			T2.nextElementSibling.nextElementSibling.classList.add("active");
			check = false;
		}
		if(check){
			#server(..cCheckNUpdatePW(T1.value,T2.value))#
		}
	}
	function removeError(e){
		if(e.target.parentElement.querySelector(".error-text.active")!=null){
			e.target.parentElement.querySelector(".error-text.active").classList.remove("active");
		}
	}
	// not use
	function openTemplatePages(e){
		e.stopPropagation();
		let pageName = e.target.id;
		window.open('jxViewTemp.csp','_self');
		#server(..cSaveBucket(pageName))#
    }
    function jLogout(){
	#server(..cLogout())#
}
    
</script>
    <script language="cache" method="cCheckNUpdatePW" arguments="d1,d2:%String">
    	d CheckNUpdatePW^jxChangePassword
    </script>

<script language="cache" method="cLogout">
	d Logout^jxLogin($g(%session.Data("UserName"))) // Log out for inactivity of 1 hour
</script>


</html>
