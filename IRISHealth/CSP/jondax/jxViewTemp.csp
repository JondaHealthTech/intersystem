<html>
    <head>
	<script language="cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
		i $g(%session.Data("UserID"))="" s %response.Redirect="jxLockDown.csp" q 1
		q 1
	</script>
	<script language="cache" runat="server">
		s id=$g(%session.Data("UserID"))
		d HEAD1^WSP999
	</script>
        <link rel="stylesheet" href="assets/styles/jxViewTemp.css">
    </head>
    <body onload="jInitMe()">
        <div id="wrapper">
            <div class="bg-wrapper">
                <div class="bg3">
                    <img src="./assets/images/bg3.png">
                </div>
            </div>
            <div class="content">
                <div class="main-field">
                    <i class="fa fa-bars mobile-active nav-toggle" style="color: #ffffff;" onclick="openMobileNav(event)"></i>
                    <img class="logo mobile-active" src="./assets/images/Jonda X Logo White Pink.png" alt="Jonda Health">
                    <h1>
                        Template: <span id="tName">Template 1</span>
                    </h1>
                    <div id="temp-content" class="temp-content">
                        <div class="filters">
                            <div class="text-fil">
                                <p onclick="jLoadTemplates(event)">All</p>
                                <p onclick="jLoadTemplates(event)">1-9</p>
                                <p onclick="jLoadTemplates(event)">A</p>
                                <p onclick="jLoadTemplates(event)">B</p>
                                <p onclick="jLoadTemplates(event)">C</p>
                                <p onclick="jLoadTemplates(event)">D</p>
                                <p onclick="jLoadTemplates(event)">E</p>
                                <p onclick="jLoadTemplates(event)">F</p>
                                <p onclick="jLoadTemplates(event)">G</p>
                                <p onclick="jLoadTemplates(event)">H</p>
                                <p onclick="jLoadTemplates(event)">I</p>
                                <p onclick="jLoadTemplates(event)">J</p>
                                <p onclick="jLoadTemplates(event)">K</p>
                                <p onclick="jLoadTemplates(event)">L</p>
                                <p onclick="jLoadTemplates(event)">M</p>
                                <p onclick="jLoadTemplates(event)">N</p>
                                <p onclick="jLoadTemplates(event)">O</p>
                                <p onclick="jLoadTemplates(event)">P</p>
                                <p onclick="jLoadTemplates(event)">Q</p>
                                <p onclick="jLoadTemplates(event)">R</p>
                                <p onclick="jLoadTemplates(event)">S</p>
                                <p onclick="jLoadTemplates(event)">T</p>
                                <p onclick="jLoadTemplates(event)">U</p>
                                <p onclick="jLoadTemplates(event)">V</p>
                                <p onclick="jLoadTemplates(event)">W</p>
                                <p onclick="jLoadTemplates(event)">X</p>
                                <p onclick="jLoadTemplates(event)">Y</p>
                                <p onclick="jLoadTemplates(event)">Z</p>
                                <p onclick="jDownloadTemplates(event)"><img src="assets\images\download.png" width="20px" style="position:relative;top:5px"></p>
                            </div>
                            <!--<button class="filter-btn"><img src="./assets/images/filter.png" alt="Filter">Filters</button>-->
                        </div>
                        <div class="table-border"></div>
                        <div class="temp-table">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                    	<th>Output Name</th>
                                        <th>Output Unit</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                        <button type="button" class="add-row" onclick="addRow(event)">Add Row</button>
                    	<div class="btn-edit-group">
                    		<button class="green-btn" onclick="saveRow()">Save Changes</button>
                    		<button class="pink-btn" onclick="cancelEdit()">Cancel</button>
                    	</div>
                    </div>
                </div>
            </div>
        </div>
        <div id="popup1" class="popup inactive">
            <div class="popup-dialog">
                <img src="./assets/images/success.png" alt="FYI">
                <h4>Are you sure you want to delete "<span id="del-val"></span>"?</h4>
                <p>This action cannot be undone.</p>
                <div class="btn-group">
                    <button class="green-btn" onclick="confirmDelete()">Yes</button>
                    <button class="pink-btn" onclick="removePopup1()">No</button>
                </div>
            </div>
        </div>
        <div id="popup2" class="popup inactive">
            <div class="popup-dialog">
                <img src="./assets/images/success.png" alt="FYI">
                <h4>"<span id="del-val1"></span>" is now deleted!</h4>
                <button class="green-btn" onclick="removePopup2()">Okay</button>
            </div>
        </div>
        <div id="popup3" class="popup inactive">
            <div class="popup-dialog">
                <img src="./assets/images/success.png" alt="FYI">
                <h4>Are you sure you want to save <span id="save-val"></span>?</h4>
                <div class="btn-group">
                    <button class="green-btn" onclick="confirmSave()">Yes</button>
                    <button class="pink-btn" onclick="removePopup3()">No</button>
                </div>
            </div>
        </div>
        <div id="popup4" class="popup inactive">
            <div class="popup-dialog">
                <img src="./assets/images/success.png" alt="FYI">
                <h4>Please make sure you fill up <br> both the name and the unit!!</h4>
                <button class="green-btn" onclick="removePopup4()">Okay</button>
            </div>
        </div>
        <div id="popup5" class="popup inactive">
            <div class="popup-dialog">
                <img src="./assets/images/success.png" alt="FYI">
                <h4>"<span id="save-val1"></span>" is now saved!</h4>
	                <button class="green-btn" onclick="removePopup5()">Okay</button>
            </div>
        </div>
        <div id="popup6" class="popup inactive">
            <div class="popup-dialog">
                <img src="./assets/images/success.png" alt="FYI">
                <h4>Changes are now saved!</h4>
	                <button class="green-btn" onclick="removePopup6()">Okay</button>
            </div>
        </div>
        <script>
            var resizefunc = [];
        </script>
        <!-- jQuery  -->
		<script language="cache" runat="server">
			d jQueryCore^WSP999
		</script>
    </body>
    <script type="text/javascript">
    let popup1 = document.getElementById("popup1");
    let popup2 = document.getElementById("popup2");
    let popup3 = document.getElementById("popup3");
    let popup4 = document.getElementById("popup4");
    let popup5 = document.getElementById("popup5");
    let popup6 = document.getElementById("popup6");
    let currentTr;
    let val1;
    let val2;
    let bk;
	window.onload = jInitMe;
  	document.onmousemove = parent.resetTimer;
  	document.onmousedown = parent.resetTimer; // touchscreen presses
  	document.ontouchstart = parent.resetTimer;
  	//document.onclick = parent.resetTimer; // touchpad clicks
  	document.onkeypress = parent.resetTimer;
  	document.addEventListener('scroll', parent.resetTimer, true);
  	
    	function jInitMe(){
	    	parent.resetTimer();
	    	#server(..cInitMe())#;
    		setTableBorderPos();
    	}
    	function setTableBorderPos(){
	    	let tempTable = document.querySelector(".temp-table");
	    	let tablePos = tempTable.querySelector("table").getBoundingClientRect();
	    	let tableBorder = document.querySelector(".table-border");
	    	tableBorder.style.width = "calc("+tablePos.width +"px + 4px)";
	    	if(tempTable.scrollHeight > tempTable.clientHeight){
		    	tableBorder.style.height = "calc("+tempTable.clientHeight +"px + 4px)";
	    	}
	    	else{
	    		tableBorder.style.height = "calc("+tablePos.height +"px + 4px)";
	    	}
	    	tableBorder.style.top = "calc("+tablePos.y +"px - 2px)";
	    	tableBorder.style.left = "calc("+tablePos.x+"px - 2px)";
    	}
    	function jLoadTemplates(e){
	    	let start=e.target.textContent;
	    	if(start.startsWith("0")){
		    	start="num"
	    	}
	    	if(start=="All"){
		    	start=""
	    	}
	    	#server(..cLoadTemplates(start))#
	    	setTableBorderPos();
    	}
    	function jDownloadTemplates(){
	    	#server(..cDownloadTemplates())#
    	}
    	function editRow(e){
	    	if(currentTr==null){
	    		currentTr = e.target.parentElement.parentElement;
	    		tds = currentTr.querySelectorAll("td");
	    		val1 = tds[0].textContent;
	    		val2 = tds[1].textContent;
	    		tds[0].innerHTML = "<input type='text' name='textname' value='"+val1+"'>";
	    		tds[1].innerHTML = "<input type='text' name='textname' value='"+val2+"'>";
	    		tds[2].querySelector("img").style.opacity=0;
    			document.querySelector(".btn-edit-group").style.display="block";
    			document.querySelector(".add-row").style.display="none";
	    	}
	    	else{
		    	alert("You cannot edit multiple testnames at the same time");
	    	}
    	}
    	function deleteRow(e){
	    	let value = e.target.parentElement.parentElement.firstElementChild.textContent;
	    	currentTr = e.target.parentElement.parentElement;
	    	document.getElementById("del-val").innerHTML = value;
	    	document.getElementById("del-val1").innerHTML = value;
	    	setTimeout(()=>{
	    		popup1.classList.remove("inactive");
	    	},100);
    	}
    	function confirmDelete(){
	    	//deleteRow from database
	    	#server(..cDeleteTemplate(currentTr.firstElementChild.textContent))#
    		currentTr.remove();
    		currentTr=null;
    	}
        function removePopup1(){
            popup1.classList.add("inactive");
        }
        function removePopup2(){
            popup2.classList.add("inactive");
        }
        function removePopup3(){
            popup3.classList.add("inactive");
        }
        function removePopup4(){
            popup4.classList.add("inactive");
        }
        function removePopup5(){
            popup5.classList.add("inactive");
        }
        function removePopup6(){
            popup6.classList.add("inactive");
        }
    	function addRow(e){
	    	let tempTable = document.querySelector(".temp-table");
	    	let tbody = document.querySelector("tbody");
	    	let tr = document.createElement("tr");
	    	tr.classList.add("new");
	    	tr.innerHTML = "<td><input type='text' name='testname' placeholder='Enter new testname'></td><td><input type='text' name='testunit' placeholder='Enter unit'></td><td></td>"
    		tbody.appendChild(tr);
    		currentTr = tr;
    		tempTable.scrollTop = tempTable.scrollHeight;
    		e.target.style.display="none";
    		document.querySelector(".btn-edit-group").style.display="block";
    	}
    	function saveRow(){
	    	let inputs = document.querySelectorAll("input");
	    	if(inputs[0].value=="" || inputs[1].value==""){
		    	popup4.classList.remove("inactive");
		    	return;
	    	}
	    	if(currentTr.classList.contains("new")){
	    		document.getElementById("save-val").innerHTML = "\""+inputs[0].value+"\"";
	    		document.getElementById("save-val1").innerHTML = inputs[0].value;
	    	}
	    	else{
	    		document.getElementById("save-val").innerHTML = "changes";
	    	}
	    	popup3.classList.remove("inactive");
    	}
    	function confirmSave(){
	    	let inputs = document.querySelectorAll("input");
	    	if(currentTr.classList.contains("new")){
	    		#server(..cSaveNewTemplate(inputs[0].value,inputs[1].value))#
	    	}
	    	else{
	    		#server(..cUpdateTemplate(val1,inputs[0].value,inputs[1].value))#;
	    	}
	    	let tds = currentTr.querySelectorAll("td");
	    	tds[0].innerHTML = inputs[0].value;
	    	tds[1].innerHTML = inputs[1].value;
	    	tds[2].innerHTML = "<td><img class='edit-icon' src='./assets/images/edit.png' alt='Edit' onclick='editRow(event)'> <img src='./assets/images/delete.png' alt='Delete' onclick='deleteRow(event)'></td>";
	    	currentTr.classList.add("edited");
    		document.querySelector(".btn-edit-group").style.display="none";
    		document.querySelector(".add-row").style.display="block";
    		currentTr=null;
    	}
    	function cancelEdit(){
	    	if(currentTr==document.querySelector("tbody").lastElementChild && currentTr.classList.contains("new")){
		    	document.querySelector("tbody").lastElementChild.remove();
	    	}
	    	else{
	    		tds = currentTr.querySelectorAll("td");
	    		tds[0].innerHTML = val1;
	    		tds[1].innerHTML = val2;
	    		tds[2].querySelector("img").style.opacity=1;
	    	}
	    	currentTr = null;
    		document.querySelector(".btn-edit-group").style.display="none";
    		document.querySelector(".add-row").style.display="block";
    	}
        document.addEventListener("click",(e)=>{
            if(e.target.closest(".popup-dialog")==null){
                removePopup1();
            }
        })
    </script>
    <script language="cache" method="cInitMe">
    	d InitMe^jxViewTemp
    </script>
    <script language="cache" method="cLoadTemplates" arguments="d1:%String">
    	d LoadTemplates^jxViewTemp(d1)
    </script>
    <script language="cache" method="cDownloadTemplates">
    	d DownloadTemplates^jxViewTemp
    </script>
    <script language="cache" method="cSaveNewTemplate" arguments="d1,d2:%String">
    	d SaveNewTemplate^jxViewTemp
    </script>
    <script language="cache" method="cDeleteTemplate" arguments="d1:%String">
    	d DeleteTemplate^jxViewTemp
    </script>
    <script language="cache" method="cUpdateTemplate" arguments="d1,d2,d3:%String">
    	d UpdateTemplate^jxViewTemp
    </script>
</html>
